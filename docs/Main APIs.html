<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Main APIs  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Main APIs  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          RubyGateway Docs
        </a>
         (100% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/johnfairh/RubyGateway">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">RubyGateway Reference</a>
      <img class="carat" src="img/carat.png" />
      Main APIs  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="user-guide.html">User Guide</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="todo.html">TODO</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Main APIs.html">Main APIs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/RbGateway.html">RbGateway</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/RbGateway/Verbosity.html">– Verbosity</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/RbObject.html">RbObject</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/RbObjectAccess.html">RbObjectAccess</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other APIs.html">Other APIs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other APIs.html#/s:11RubyGateway15RbBlockCallbacka">RbBlockCallback</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/RbBlockRetention.html">RbBlockRetention</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/RbBreak.html">RbBreak</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/RbProc.html">RbProc</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/RbSymbol.html">RbSymbol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/RbThread.html">RbThread</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/RbThread/UnblockingFunc.html">– UnblockingFunc</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/RbType.html">RbType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Error Handling.html">Error Handling</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/RbError.html">RbError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/RbError/History.html">– History</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/RbException.html">RbException</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/RbFailableAccess.html">RbFailableAccess</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Swift Interop.html">Swift Interop</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/RbObjectConvertible.html">RbObjectConvertible</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/String.html">String</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Bool.html">Bool</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UInt.html">UInt</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UInt64.html">UInt64</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UInt32.html">UInt32</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UInt16.html">UInt16</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UInt8.html">UInt8</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int.html">Int</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int64.html">Int64</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int32.html">Int32</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int16.html">Int16</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int8.html">Int8</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Double.html">Double</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Float.html">Float</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Array.html">Array</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Dictionary.html">Dictionary</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            <h1>Main APIs</h1>
            <p>These types form the main API to RubyGateway.</p>

          </div>
        </section>

        <section class="section">
          <div class="section-content">
            <div class="task-group">
              <ul class="item-container">
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:11RubyGateway02RbB0C"></a>
                    <a name="//apple_ref/swift/Class/RbGateway" class="dashAnchor"></a>
                    <a class="token" href="#/s:11RubyGateway02RbB0C">RbGateway</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Provides information about the Ruby VM, some control over how code is run,
and services to access various kinds of Ruby objects from the top level.</p>

<p>You cannot instantiate this type.  Instead RubyGateway exports a public
instance <code>Ruby</code>.  Among other things this permits dynamic member lookup
and callable-style programming in Swift 5.</p>

<p>The Ruby VM is initialized when the object is first accessed and is
automatically stopped when the process ends.  The VM can be manually shut
down before process exit by calling <code><a href="Classes/RbGateway.html#/s:11RubyGateway02RbB0C7cleanups5Int32VyF">RbGateway.cleanup()</a></code> but once this has
been done the VM cannot be restarted and subsequent calls to RubyGateway
services will fail.</p>

<p>The loadpath (where <code>require</code> looks) is set to the <code>lib/ruby</code> directories
adjacent to the <code>libruby</code> the program is linked against and <code>$RUBYLIB</code>.
RubyGems are enabled.</p>
<h2 id='accessing-ruby-objects' class='heading'>Accessing Ruby objects</h2>

<p>The class inherits from <code><a href="Classes/RbObjectAccess.html">RbObjectAccess</a></code> which lets you look up constants
or call functions as you would at the top level of a Ruby script, for example:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">RubyGateway</span>

<span class="nf">print</span><span class="p">(</span><span class="s">"Ruby version is </span><span class="se">\(</span><span class="kt">Ruby</span><span class="o">.</span><span class="n">version</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>

<span class="k">do</span> <span class="p">{</span>
   <span class="k">try</span> <span class="kt">Ruby</span><span class="o">.</span><span class="nf">require</span><span class="p">(</span><span class="s">"rouge"</span><span class="p">)</span>
   <span class="k">let</span> <span class="nv">html</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Ruby</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"Rouge"</span><span class="p">)</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="s">"highlight"</span><span class="p">,</span> <span class="nv">args</span><span class="p">:</span> <span class="p">[</span><span class="s">"let a = 1"</span><span class="p">,</span> <span class="s">"swift"</span><span class="p">,</span> <span class="s">"html"</span><span class="p">])</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>

<p>Or with Swift 5 dynamic member lookup &amp; callable:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">html</span> <span class="o">=</span> <span class="kt">Ruby</span><span class="o">.</span><span class="kt">Rouge</span><span class="o">!.</span><span class="nf">highlight</span><span class="p">(</span><span class="s">"let a = 1"</span><span class="p">,</span> <span class="s">"swift"</span><span class="p">,</span> <span class="s">"html"</span><span class="p">)</span><span class="o">!</span>
</code></pre>

<p>If you just want to create a Ruby object of some class, see
<code><a href="Classes/RbObject.html#/s:11RubyGateway8RbObjectCACSgSS7ofClass_SayAA0cD11Convertible_pSgG4argsSaySS_AGtG6kwArgstcfc">RbObject.init(ofClass:args:kwArgs:)</a></code>.</p>

                        <a href="Classes/RbGateway.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">RbGateway</span> <span class="p">:</span> <span class="kt"><a href="Classes/RbObjectAccess.html">RbObjectAccess</a></span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/johnfairh/RubyGateway/tree/master//Sources/RubyGateway/RbGateway.swift#L51-L159">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:11RubyGateway8RbObjectC"></a>
                    <a name="//apple_ref/swift/Class/RbObject" class="dashAnchor"></a>
                    <a class="token" href="#/s:11RubyGateway8RbObjectC">RbObject</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>A Ruby object.</p>

<p>All Ruby objects whatever their type or class are represented using this
Swift type.</p>

<p>Use <code><a href="Classes/RbObject.html#/s:11RubyGateway8RbObjectCACSgSS7ofClass_SayAA0cD11Convertible_pSgG4argsSaySS_AGtG6kwArgstcfc">RbObject.init(ofClass:args:kwArgs:)</a></code> to create a new Ruby object of
some class:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">myObj</span> <span class="o">=</span> <span class="kt">RbObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="s">"MyModule::MyClass"</span><span class="p">,</span> <span class="nv">args</span><span class="p">:</span> <span class="p">[</span><span class="s">"arg1"</span><span class="p">,</span> <span class="mf">25.3</span><span class="p">])</span>
</code></pre>

<p>See <code><a href="Classes/RbObjectAccess.html">RbObjectAccess</a></code> for ways to call methods, access properties, and find
constants from an <code>RbObject</code>:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="n">myObj</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"fred"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">results</span> <span class="o">=</span> <span class="k">try</span> <span class="n">myObj</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="s">"process"</span><span class="p">,</span> <span class="nv">args</span><span class="p">:</span> <span class="p">[</span><span class="s">"arg1"</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
</code></pre>

<p>Or in Swift 5 dynamic-member style:</p>
<pre class="highlight swift"><code><span class="n">myObj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"fred"</span>

<span class="k">let</span> <span class="nv">results</span> <span class="o">=</span> <span class="n">myObj</span><span class="o">.</span><span class="nf">process</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</code></pre>

<p>See <code><a href="Classes/RbGateway.html">RbGateway</a></code> and its global instance <code>Ruby</code> for access to the Ruby &lsquo;top self&rsquo;
object to get started finding constants or calling global functions.</p>
<h2 id='converting-to-and-from-swift-types' class='heading'>Converting to and from Swift types</h2>

<p>Convert <code>RbObject</code>s to Swift types using failable initializers:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">height</span> <span class="o">=</span> <span class="kt">Double</span><span class="p">(</span><span class="n">myObj</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">allHeights</span> <span class="o">=</span> <span class="kt">Array</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">myObj</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">heightDb</span> <span class="o">=</span> <span class="kt">Dictionary</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">myObj</span><span class="p">)</span>
</code></pre>

<p>Check <code><a href="Enums/RbError.html#/s:11RubyGateway7RbErrorO7historyAC7HistoryVvpZ">RbError.history</a></code> to see the cause of failed initializations.</p>

<p>In the reverse direction, Swift types convert implicitly to <code>RbObject</code>
when passed as arguments via the <code><a href="Protocols/RbObjectConvertible.html">RbObjectConvertible</a></code> protocol.</p>
<h2 id='standard-library-conformances' class='heading'>Standard library conformances</h2>

<p><code>RbObject</code> conforms to <code>Hashable</code>, <code>Equatable</code>, and <code>Comparable</code> protocols by
forwarding to the corresponding Ruby methods.  Beware though that it is easy
to trigger Ruby errors here that currently cause RubyGateway to crash.  For
example this is poison:</p>
<pre class="highlight swift"><code><span class="kt">RbObject</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="kt">RbObject</span><span class="p">(</span><span class="s">"barney"</span><span class="p">)</span>
</code></pre>

<p>I plan to add more control over what happens here.</p>
<h2 id='arithmetic-operators' class='heading'>Arithmetic operators</h2>

<p><code>RbObject</code> conforms to the <code>SignedNumeric</code> protocol by forwarding the regular
arithmetic operators to the corresponding Ruby methods.  This means you can
write <code>let a = b + c</code> where all are <code>RbObject</code>s and get a valid value for <code>a</code>
provided <code>b</code> and <code>c</code> are any of the Ruby numeric values or any Ruby class that
happens to support those operators.</p>

<p>Again you must take ensure that your Ruby objects support these operators or
the program will crash.</p>

                        <a href="Classes/RbObject.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">RbObject</span> <span class="p">:</span> <span class="kt"><a href="Classes/RbObjectAccess.html">RbObjectAccess</a></span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/johnfairh/RubyGateway/tree/master//Sources/RubyGateway/RbObject.swift#L73-L151">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:11RubyGateway14RbObjectAccessC"></a>
                    <a name="//apple_ref/swift/Class/RbObjectAccess" class="dashAnchor"></a>
                    <a class="token" href="#/s:11RubyGateway14RbObjectAccessC">RbObjectAccess</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Provides services to manipulate a Ruby object:</p>

<ul>
<li>Call methods;</li>
<li>Access properties and instance variables;</li>
<li>Access class variables;</li>
<li>Access global variables;</li>
<li>Find constants, classes, and modules.</li>
</ul>

<p>The class is abstract.  You use it via <code><a href="Classes/RbObject.html">RbObject</a></code> and the global <code>Ruby</code> instance
of <code><a href="Classes/RbGateway.html">RbGateway</a></code>.</p>

<p>By default all methods throw <code><a href="Enums/RbError.html">RbError</a></code>s if anything goes wrong including
when Ruby raises an exception.  Use the <code><a href="Classes/RbObjectAccess.html#/s:11RubyGateway14RbObjectAccessC8failableAA0c8FailableE0Vvp">RbObjectAccess.failable</a></code> adapter to
access an alternative API that returns <code>nil</code> on errors instead.  You can still
see any Ruby exceptions via <code><a href="Enums/RbError.html#/s:11RubyGateway7RbErrorO7historyAC7HistoryVvpZ">RbError.history</a></code>.</p>
<h2 id='calling-methods' class='heading'>Calling methods</h2>

<p>Ruby has a few different ways to call methods that are reflected in the
various Swift methods here and their types.  The degrees of freedom are:</p>

<ol>
<li>Call method by name or by symbol;</li>
<li>Pass positional and/or keyword arguments;</li>
<li>Optionally pass a block that can be expressed as a Swift function or
a Ruby Proc.</li>
<li>Method can either raise an exception or return a value.</li>
</ol>

<p>From the simple end:</p>
<pre class="highlight swift"><code><span class="k">try!</span> <span class="n">obj</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="s">"myMethod"</span><span class="p">)</span>
</code></pre>

<p>&hellip;to:</p>
<pre class="highlight swift"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span>
         <span class="k">try</span> <span class="n">obj</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="nv">symbol</span><span class="p">:</span> <span class="n">myMethodSymbol</span><span class="p">,</span>
                      <span class="nv">args</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s">"3.5"</span><span class="p">,</span> <span class="n">myHash</span><span class="p">],</span>
                      <span class="nv">kwArgs</span><span class="p">:</span> <span class="p">[(</span><span class="s">"mode"</span><span class="p">,</span> <span class="kt">RbSymbol</span><span class="p">(</span><span class="s">"debug"</span><span class="p">)])</span> <span class="p">{</span> <span class="n">blockArgs</span> <span class="k">in</span>
                          <span class="n">blockArgs</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                              <span class="nf">process</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
                          <span class="p">}</span>
                      <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">RbError</span><span class="o">.</span><span class="nf">rubyException</span><span class="p">(</span><span class="k">let</span> <span class="nv">exn</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">handleErrors</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre>

                        <a href="Classes/RbObjectAccess.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">RbObjectAccess</span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/johnfairh/RubyGateway/tree/master//Sources/RubyGateway/RbObjectAccess.swift#L57-L121">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </section>

      </article>
    </div>
    <section class="footer">
      <p>Distributed under the MIT license.  Maintained by <a class="link" href="mailto:johnfairh@gmail.com" target="_blank" rel="external">John Fairhurst</a>.</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.1</a>-<a class="link" href="https://github.com/johnfairh/jazzy" target="_blank" rel="external">bebop</a>, originally a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
