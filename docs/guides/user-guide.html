<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
 
    <link rel="stylesheet" href="../css/fw2020.css">
    
    
   <title>User Guide - RubyGateway 6.0.0 docs</title>
    
  </head>
  <body class="j2-swift " data-root-path="./../" data-doc-path="guides/user-guide.html" data-assets-path="../">

  <!-- messages for search -->
  <div hidden>
    <span id="text-loading">Loading index...</span>
    <span id="text-failed">Failed to load index</span>
    <span id="text-notfound">No matches</span>
  </div>

  <header class="j2-header">
  <div class="navbar navbar-expand navbar-dark j2-titlebar">
  <div class="container-fluid ps-0 pe-0">
  <a class="visually-hidden-focusable visually-hidden fw-slightly-bold pe-2" href="#main-content">Skip to main content</a>
  <a class="nav-item nav-link ps-0 pt-1 pe-2 d-md-none" id="nav-toggle-button" role="button" aria-controls="nav-column" aria-expanded="false" aria-label="Toggle navigation" href="#">
    <span class="navbar-toggler-icon"></span>
  </a>

  <div class="navbar-brand me-1 fw-slightly-bold">
    
    <a href="../index.html">
    
    RubyGateway 6.0.0 docs</a>
  </div>
  
  <span class="navbar-text j2-coverage fw-slightly-bold small d-none d-lg-inline-block me-2">(100% documented)</span>
  

  <div class="navbar-nav ms-auto justify-content-end flex-fill">

    
    <form class="d-none d-md-block my-auto pe-2 ps-2" role="search">
      <input class="form-control form-control-sm w-100" type="search" placeHolder="Search" aria-label="Search" aria-keyshortcuts="/" data-search-format="span">
    </form>
    

    

    
    <a class="nav-item nav-link d-none d-sm-inline" rel="external" href="https://github.com/johnfairh/RubyGateway">
      <svg class="j2-title-svg" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 16 16"><title>Open on GitHub</title><path fill="currentcolor" fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
      </svg>
    </a>
    
    
    
    

    
      <a class="nav-item nav-link d-none d-sm-inline" rel="alternate" href="dash-feed://https%3A%2F%2Fjohnfairh%2Egithub%2Eio%2FRubyGateway%2Fdocsets%2FRubyGateway%2Exml">
      <svg class="j2-title-svg" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 700 670">
        <title>Open in Dash</title>
        <path fill="currentcolor" d="m0 0 132.58 160.54h130.76v0.0312c63.501 0.196 140.87-6.9887 193.12 10.227 26.125 8.6076 43.475 19.899 57.578 40.781 14.103 20.882 26.733 55.737 25.781 118.52-0.8784 57.953-16.7 88.91-38.672 112.89-21.972 23.98-54.208 41.154-90.703 51.953-28.462 8.4219-55.314 10.153-80.547 11.953v-266.25h-160v419.92l71.328 7.8125s103.75 12.802 214.61-20c55.429-16.401 115.46-45.078 163.28-97.266 47.816-52.187 79.327-127.83 80.703-218.59 1.3028-85.935-16.743-156.6-53.125-210.47-36.382-53.871-89.369-86.47-140.16-103.2-50.787-16.733-101.87-18.272-145.08-18.504-43.211-0.2316-78.502 0.0768-97.578 0.0176v2e-3h-131.31z"/>
      </svg>
    </a>
    

    

  </div>
  </div>
</div>

<!-- narrow-style searchbar -->


<div class="container-fluid j2-titlebar d-md-none">
  <div class="row">
    <div class="col">
      <form class="pb-2">
        <input class="form-control form-control-sm" type="search" placeHolder="Search" aria-label="Search" aria-keyshortcuts="/" data-search-format="div">
      </form>
    </div>
  </div>
</div>


  <nav aria-label="breadcrumb" class="small">
  
  
    <ol class="breadcrumb j2-breadcrumb j2-swift">
      <li class="breadcrumb-item"><a href="../index.html">RubyGateway</a></li>
      
        
          <li class="breadcrumb-item"><a href="../guides.html?swift">Guides</a></li>
        
        
      
        
        
          <li class="breadcrumb-item" aria-current="page">User Guide</li>
        
      
    </ol>
  
</nav>

  </header>

  <div class="container-fluid">
    <div class="row">
      <div class="col-auto d-none d-md-flex flex-column j2-nav" id="nav-column">
  
    <nav aria-label="Swift" class="j2-swift">
    <ul class="j2-nav-list">
      
      <li class="j2-nav-group">
        

  <a class="j2-nav-item" href="../guides.html?swift">Guides</a>


  <ul class="j2-nav-sublist">
  
  <li>
    
  <a class="j2-nav-item active" href="#" aria-current="page">User Guide</a>




  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../guides/todo.html?swift">TODO</a>



  </li>
  
</ul>



      </li>
      
      <li class="j2-nav-group">
        

  <a class="j2-nav-item" href="../main-apis.html?swift">Main APIs</a>


  <ul class="j2-nav-sublist">
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbgateway1.html?swift">RbGateway</a>


  <ul class="j2-nav-sublist">
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbgateway1/verbosity.html?swift">Verbosity</a>



  </li>
  
</ul>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbobject13.html?swift">RbObject</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbobjectaccess1.html?swift">RbObjectAccess</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbobjectcollection.html?swift">RbObjectCollection</a>



  </li>
  
</ul>



      </li>
      
      <li class="j2-nav-group">
        

  <a class="j2-nav-item" href="../swift-method-apis.html?swift">Swift Method APIs</a>


  <ul class="j2-nav-sublist">
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbmethodargsspec.html?swift">RbMethodArgsSpec</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../swift-method-apis.html?swift#rbmethodcallback">RbMethodCallback</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../swift-method-apis.html?swift#rbboundmethodcallback">RbBoundMethodCallback</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../swift-method-apis.html?swift#rbboundmethodvoidcallback">RbBoundMethodVoidCallback</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbmethod.html?swift">RbMethod</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbmethodargs.html?swift">RbMethodArgs</a>



  </li>
  
</ul>



      </li>
      
      <li class="j2-nav-group">
        

  <a class="j2-nav-item" href="../other-apis.html?swift">Other APIs</a>


  <ul class="j2-nav-sublist">
  
  <li>
    

  <a class="j2-nav-item" href="../other-apis.html?swift#rbblockcallback">RbBlockCallback</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbblockretention.html?swift">RbBlockRetention</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbbreak.html?swift">RbBreak</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbproc.html?swift">RbProc</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbsymbol.html?swift">RbSymbol</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbthread.html?swift">RbThread</a>


  <ul class="j2-nav-sublist">
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbthread/unblockingfunc.html?swift">UnblockingFunc</a>



  </li>
  
</ul>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbtype.html?swift">RbType</a>



  </li>
  
</ul>



      </li>
      
      <li class="j2-nav-group">
        

  <a class="j2-nav-item" href="../error-handling.html?swift">Error Handling</a>


  <ul class="j2-nav-sublist">
  
  <li>
    

  <a class="j2-nav-item" href="../types/rberror.html?swift">RbError</a>


  <ul class="j2-nav-sublist">
  
  <li>
    

  <a class="j2-nav-item" href="../types/rberror/history.html?swift">History</a>



  </li>
  
</ul>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbexception.html?swift">RbException</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbfailableaccess.html?swift">RbFailableAccess</a>



  </li>
  
</ul>



      </li>
      
      <li class="j2-nav-group">
        

  <a class="j2-nav-item" href="../swift-interop.html?swift">Swift Interop</a>


  <ul class="j2-nav-sublist">
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbobjectconvertible.html?swift">RbObjectConvertible</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/string.html?swift">String</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/bool.html?swift">Bool</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/uint.html?swift">UInt</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/uint64.html?swift">UInt64</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/uint32.html?swift">UInt32</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/uint16.html?swift">UInt16</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/uint8.html?swift">UInt8</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/int.html?swift">Int</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/int64.html?swift">Int64</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/int32.html?swift">Int32</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/int16.html?swift">Int16</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/int8.html?swift">Int8</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/double.html?swift">Double</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/float.html?swift">Float</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/array.html?swift">Array</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/arrayslice.html?swift">ArraySlice</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/dictionary.html?swift">Dictionary</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/set.html?swift">Set</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/range.html?swift">Range</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../extensions/closedrange.html?swift">ClosedRange</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbcomplex.html?swift">RbComplex</a>



  </li>
  
  <li>
    

  <a class="j2-nav-item" href="../types/rbrational.html?swift">RbRational</a>



  </li>
  
</ul>



      </li>
      
    </ul>
  </nav>
  
</div>

      <main class="col col-xl-8 j2-article px-lg-4 px-xl-5" id="article-column">
        <article class="j2-article-wrapper" id="main-content">

        <section>
          
          
          
          
          <h1 class="j2-anchor j2-heading heading" id="using-rubygateway">
<span data-anchor-id="using-rubygateway">
Using RubyGateway
</span></h1>
<p>This document contains notes on using RubyGateway.  For installation tips
see <a href="index.html">the README</a>.</p>
<ul>
<li><a href="#general-usage">How to use the framework</a></li>
<li><a href="#how-to">How to do various Ruby tasks</a></li>
<li><a href="#error-handling">Error handling approach</a></li>
<li><a href="#concurrency">Concurrency and multi-threading</a></li>
<li><a href="#caveats-and-gotchas">Health warning</a></li>
<li><a href="#using-the-cruby-api">Using the libruby API</a></li>
<li><a href="#garbage-collection">Garbage collection notes</a></li>
</ul>
<h2 class="j2-anchor j2-heading heading" id="general-usage">
<span data-anchor-id="general-usage">
General Usage
</span></h2>
<p>The Ruby VM is initialized when you first try to use it and shut down when the
process ends.  Load Ruby code using <a href="../types/rbgateway1.html?swift#loadfilenamewrap"><code>RbGateway.load(filename:wrap:)</code></a> or
<a href="../types/rbgateway1.html?swift#requirefilename"><code>RbGateway.require(filename:)</code></a>.  Or just run some Ruby code and get the result
using <a href="../types/rbgateway1.html?swift#evalruby"><code>RbGateway.eval(ruby:)</code></a>.  There already is a global instance of <a href="../types/rbgateway1.html?swift"><code>RbGateway</code></a>
called <code>Ruby</code> so the code looks like:</p>
<pre><code class="language-swift">import RubyGateway

do {
    let result = try Ruby.eval(ruby: &quot;'a' * 4&quot;)
    print(result)
} catch {
}
</code></pre>
<p>Create objects using <a href="../types/rbobject13.html?swift#initofclassargskwargs"><code>RbObject.init(ofClass:args:kwArgs:)</code></a>.  Pass Swift types
or <a href="../types/rbobject13.html?swift"><code>RbObject</code></a>s to the <code>args</code> parameter.</p>
<p>Use <a href="../types/rbobjectaccess1.html?swift#call_argskwargs1"><code>RbObjectAccess.call(_:args:kwArgs:)</code></a> to call methods on the object.  See
<a href="../types/rbobjectaccess1.html?swift"><code>RbObjectAccess</code></a> for more object operations and variations on <code>call</code> including
passing Swift code as a block.  Again pass Swift types or <a href="../types/rbobject13.html?swift"><code>RbObject</code></a>s in the
<code>args</code> parameter.</p>
<p>Use optional initializers to convert from <a href="../types/rbobject13.html?swift"><code>RbObject</code></a>s back to Swift types, or
implicitly/explicitly access <a href="../types/rbobject13.html?swift#description2"><code>RbObject.description</code></a> if you just want <a href="../extensions/string.html?swift"><code>String</code></a>.</p>
<pre><code class="language-swift">import RubyGateway

do {
    try Ruby.require(filename: &quot;academy&quot;)
    let student = try RbObject(ofClass: &quot;Academy::Student&quot;,
                               kwArgs: [&quot;name&quot;: &quot;Betty&quot;])
    if let bettyGpa = try Double(student.get(&quot;gpa&quot;)) {
        processScore(gpa: bettyGpa)
    }
} catch {
}
</code></pre>
<p>Define new modules with <a href="../types/rbgateway1.html?swift#definemodule_under"><code>RbGateway.defineModule(_:under:)</code></a> and new classes with
<a href="../types/rbgateway1.html?swift#defineclass_parentunder"><code>RbGateway.defineClass(_:parent:under:)</code></a>.  Define methods on new or existing
classes or modules with <a href="../types/rbobject13.html?swift#definemethod_argsspecbody"><code>RbObject.defineMethod(_:argsSpec:body:)</code></a> and
<a href="../types/rbobject13.html?swift#definesingletonmethod_argsspecbody"><code>RbObject.defineSingletonMethod(_:argsSpec:body:)</code></a>.</p>
<p>Defining a module with a static API:</p>
<pre><code class="language-swift">let myModule = try Ruby.defineModule(&quot;Bakery&quot;)

try myModule.defineSingletonMethod(&quot;reserve_cakes&quot;, .basic(1)) { _, method in
    if let cakeCount = Int(method.args.mandatory[0]) {
        Cakes.reserve(cakeCount)
    }
    return .nilObject
}
</code></pre>
<p>…called from Ruby:</p>
<pre><code class="language-ruby">def daily_routine
  Bakery.reserve_cakes(4)
end
</code></pre>
<p>Define new classes bound directly to Swift classes with
<a href="../types/rbgateway1.html?swift#defineclass_underinitializer"><code>RbGateway.defineClass(_:under:initializer:)</code></a> and define methods on them bound
directly to Swift methods with <a href="../types/rbobject13.html?swift#definemethod_argsspecmethod1"><code>RbObject.defineMethod(_:argsSpec:method:)</code></a>.
See <a href="#define-new-classes-in-swift">below</a> for more on this.</p>
<pre><code class="language-swift">let cellClass = try Ruby.defineClass(&quot;Cell&quot;, initializer: Cell.init)

try cellClass.defineMethod(&quot;initialize&quot;,
        argsSpec: RbMethodArgsSpec(mandatoryKeywords: [&quot;width&quot;, &quot;height&quot;])
        method: Cell.setup)

try cellClass.defineMethod(&quot;content&quot;,
        argsSpec: RbMethodArgsSpec(requiresBlock: true),
        method: Cell.getContent)
</code></pre>
<p>…called from Ruby:</p>
<pre><code class="language-ruby">cell = Cell.new(width: 200, height: 100)
cell.content { |c| prettyprint(c) }
</code></pre>
<h2 class="j2-anchor j2-heading heading" id="how-to-">
<span data-anchor-id="how-to-">
How to …
</span></h2>
<p>A few Ruby-ish tasks.  Lots of these are more long-winded in Swift.  The idea
here though is not to let you write Ruby using Swift: use Ruby to do that!  But
rather to provide a layer that lets you bridge between Ruby and Swift code,
which will sometimes require driving the Ruby code in these ways.</p>
<h3 class="j2-anchor j2-heading heading" id="exchange-swift-types">
<span data-anchor-id="exchange-swift-types">
Exchange Swift types
</span></h3>
<p>RubyGateway provides extensions to most Swift types so you can initialize
<a href="../types/rbobject13.html?swift"><code>RbObject</code></a>s with them and vice versa, or use them directly as arguments to
<a href="../types/rbobjectaccess1.html?swift#callsymbolargskwargsblock1"><code>RbObjectAccess.call(...)</code></a> and friends.  Supported types are:</p>
<ul>
<li><a href="../extensions/bool.html?swift"><code>Bool</code></a></li>
<li><a href="../extensions/string.html?swift"><code>String</code></a></li>
<li>Floating point - <a href="../extensions/float.html?swift"><code>Float</code></a> and <a href="../extensions/double.html?swift"><code>Double</code></a></li>
<li>Unsigned integer - <a href="../extensions/uint.html?swift"><code>UInt</code></a>, <a href="../extensions/uint64.html?swift"><code>UInt64</code></a>, <a href="../extensions/uint32.html?swift"><code>UInt32</code></a>, <a href="../extensions/uint16.html?swift"><code>UInt16</code></a>, <a href="../extensions/uint8.html?swift"><code>UInt8</code></a></li>
<li>Signed integer - <a href="../extensions/int.html?swift"><code>Int</code></a>, <a href="../extensions/int64.html?swift"><code>Int64</code></a>, <a href="../extensions/int32.html?swift"><code>Int32</code></a>, <a href="../extensions/int16.html?swift"><code>Int16</code></a>, <a href="../extensions/int8.html?swift"><code>Int8</code></a></li>
<li><a href="../extensions/array.html?swift"><code>Array</code></a> or <a href="../extensions/arrayslice.html?swift"><code>ArraySlice</code></a> with supported element type</li>
<li><a href="../extensions/dictionary.html?swift"><code>Dictionary</code></a> with supported key and value types</li>
<li><a href="../extensions/set.html?swift"><code>Set</code></a> with supported element type</li>
<li>Range types with supported bound types - <a href="../extensions/range.html?swift"><code>Range</code></a>, <a href="../extensions/closedrange.html?swift"><code>ClosedRange</code></a></li>
</ul>
<p>See <a href="../types/rbobject13.html?swift#convertto"><code>RbObject.convert(to:)</code></a> as a throwing alternative to optional initializers.</p>
<h3 class="j2-anchor j2-heading heading" id="exchange-nil-with-ruby">
<span data-anchor-id="exchange-nil-with-ruby">
Exchange <code>nil</code> with Ruby
</span></h3>
<p>The static <a href="../types/rbobject13.html?swift#nilobject"><code>RbObject.nilObject</code></a> represents Ruby <code>nil</code> and can be passed to Ruby
methods as a parameter or used in data structures.  As a short-hand you can use
literal Swift <code>nil</code> with APIs like <a href="../types/rbobjectaccess1.html?swift#call_argskwargs1"><code>RbObjectAccess.call(_:args:kwArgs:)</code></a>.</p>
<p>When Ruby returns <code>nil</code> to Swift it always comes through as an <a href="../types/rbobject13.html?swift"><code>RbObject</code></a>.  You
can compare this directly to <a href="../types/rbobject13.html?swift#nilobject"><code>RbObject.nilObject</code></a> or use <a href="../types/rbobject13.html?swift#isnil"><code>RbObject.isNil</code></a> to
test it.</p>
<p>If you want to include Ruby <code>nil</code> in a heterogenous array use this kind of
syntax:</p>
<pre><code class="language-swift">let arr: RbObject = [1, 2.0, &quot;three&quot;, .nilObject]
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="deal-with-ruby-arrays">
<span data-anchor-id="deal-with-ruby-arrays">
Deal with Ruby arrays
</span></h3>
<p>There are a few approaches to make use of Ruby arrays depending on your goal.</p>
<ol>
<li>Convert the whole array to Swift using an initializer.  This eagerly converts
all the elements to Swift too and gives you an independent Swift array.</li>
<li>Use Ruby Array methods via <a href="../types/rbobjectaccess1.html?swift#callsymbolargskwargsblock1"><code>RbObjectAccess.call(...)</code></a>.  Doing more work in
the Ruby domain can reduce the number of elements that need to be converted
to Swift types.</li>
<li>Use Swift collection methods via <a href="../types/rbobject13.html?swift#collection"><code>RbObject.collection</code></a>.  This gives access
to the Swift collection APIs.  It’s more efficient that approach #1 if you
can avoid converting all the array elements and looks prettier if you are
aiming to mutate the array because the mutations happen in-place.</li>
</ol>
<h3 class="j2-anchor j2-heading heading" id="pass-a-symbol-as-an-argument">
<span data-anchor-id="pass-a-symbol-as-an-argument">
Pass a symbol as an argument
</span></h3>
<p>Use <a href="../types/rbsymbol.html?swift"><code>RbSymbol</code></a>.  Ruby:</p>
<pre><code class="language-ruby">res = obj.meth(:value)
</code></pre>
<p>RubyGateway:</p>
<pre><code class="language-swift">let res = try obj.call(&quot;meth&quot;, args: [RbSymbol(&quot;value&quot;)])
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="pass-a-method-as-a-block">
<span data-anchor-id="pass-a-method-as-a-block">
Pass a method as a block
</span></h3>
<p>Use <a href="../types/rbproc.html?swift"><code>RbProc</code></a> and <a href="../types/rbsymbol.html?swift"><code>RbSymbol</code></a>.  Ruby:</p>
<pre><code class="language-ruby">res = arr.each(&amp;:downcase)
</code></pre>
<p>RubyGateway:</p>
<pre><code class="language-swift">let res = try arr.call(&quot;each&quot;, block: RbProc(object: RbSymbol(&quot;downcase&quot;)))
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="pass-swift-code-as-a-block">
<span data-anchor-id="pass-swift-code-as-a-block">
Pass Swift code as a block
</span></h3>
<p>Use an <a href="../types/rbobjectaccess1.html?swift#callsymbolargskwargsblock1"><code>RbObjectAccess.call(...)</code></a> variant with a <code>blockCall</code> trailing-closure
argument.  Ruby:</p>
<pre><code class="language-ruby">obj.meth { |x| puts(x) }
</code></pre>
<p>RubyGateway:</p>
<pre><code class="language-swift">try obj.call(&quot;meth&quot;) { args in
    print(args[0])
    return .nilObject
}
</code></pre>
<p>If the method causes the Ruby object to capture the block as a proc then you
have to tell RubyGateway:</p>
<pre><code class="language-swift">try obj.call(&quot;meth&quot;, blockRetention: .self) { args in
    print(args[0])
    return .nilObject
}
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="use-break-in-a-swift-block">
<span data-anchor-id="use-break-in-a-swift-block">
Use ‘break’ in a Swift block
</span></h3>
<p>Throw an <a href="../types/rbbreak.html?swift"><code>RbBreak</code></a>.  Ruby:</p>
<pre><code class="language-ruby">result = array.each do |item|
   break item if f(item)
end
</code></pre>
<p>RubyGateway:</p>
<pre><code class="language-swift">result = try array.call(&quot;each&quot;) { args in
    if f(args[0]) {
        throw RbBreak(with: args[0])
    }
    return .nilObject
}
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="use-return-in-a-swift-block">
<span data-anchor-id="use-return-in-a-swift-block">
Use ‘return’ in a Swift block
</span></h3>
<p>Can’t do it - missing from the Ruby API.  Would probably have just been
confusing anyway.</p>
<h3 class="j2-anchor j2-heading heading" id="create-a-proc-with-swift-code">
<span data-anchor-id="create-a-proc-with-swift-code">
Create a Proc with Swift code
</span></h3>
<p>Use <a href="../types/rbobject13.html?swift#initblockcall"><code>RbObject.init(blockCall:)</code></a>.  Ruby:</p>
<pre><code class="language-ruby">myProc = proc { |a, b| a + b }
</code></pre>
<p>RubyGateway:</p>
<pre><code class="language-swift">myProc = RbObject() { args in
    return args[0] + args[1]
}
</code></pre>
<p>You must not let the <a href="../types/rbobject13.html?swift"><code>RbObject</code></a> expire while Ruby is holding on to the proc
object or the program will crash.  For example if you pass <code>myProc</code> to a
method of a Ruby object that captures the proc for later use, then you must
not let that Swift value go out of scope until the Ruby object has died or
otherwise guarantees never to invoke the proc.</p>
<p>You can’t write a Proc that accepts arguments more sophisticated than purely
positional: this is your author’s fault and may be addressed in future.</p>
<h3 class="j2-anchor j2-heading heading" id="create-a-lambda-with-swift-code">
<span data-anchor-id="create-a-lambda-with-swift-code">
Create a lambda with Swift code
</span></h3>
<p>You can’t: there’s not much value and the API doesn’t provide the argument
policing.</p>
<p>Previous versions of this document suggested this workaround:</p>
<pre><code class="language-swift">let myLambda = try Ruby.call(&quot;lambda&quot;, blockRetention: .returned) { args in
                   print(&quot;I got \(args.count) args!&quot;)
                   return .nilObject
               }
</code></pre>
<p>…but this was wrong-headed, never returned an actual lambda, and does not
work at all from Ruby 3.3.  See <a href="https://bugs.ruby-lang.org/issues/19777">Ruby #19777</a>.</p>
<h3 class="j2-anchor j2-heading heading" id="access-class-variables">
<span data-anchor-id="access-class-variables">
Access class variables
</span></h3>
<p>Use <a href="../types/rbobjectaccess1.html?swift#getclassvar_1"><code>RbObjectAccess.getClassVar(_:)</code></a> <strong>on the class</strong>: RubyGateway goes like the
Ruby API not Ruby as written.  Ruby:</p>
<pre><code class="language-ruby">class MyClass
  @@count = 0
  def initialize
    @@count += 1
  end
end
</code></pre>
<p>RubyGateway:</p>
<pre><code class="language-swift">let myClass = try Ruby.getClass(&quot;MyClass&quot;)
let count = try myClass.getClassVar(&quot;@@count&quot;)
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="implement-ruby-global-variables-in-swift">
<span data-anchor-id="implement-ruby-global-variables-in-swift">
Implement Ruby global variables in Swift
</span></h3>
<p>See <a href="../types/rbgateway1.html?swift#defineglobalvar_getset"><code>RbGateway.defineGlobalVar(_:get:set:)</code></a>.  For example:</p>
<pre><code class="language-swift">var currentEpoch: Int

Ruby.defineGlobalVar(&quot;$epoch&quot;,
                     get: { currentEpoch },
                     set: { notifyNewEpoch($0)})
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="define-and-implement-methods-in-swift">
<span data-anchor-id="define-and-implement-methods-in-swift">
Define and implement methods in Swift
</span></h3>
<p>Global functions are defined using
<a href="../types/rbgateway1.html?swift#defineglobalfunction_argsspecbody"><code>RbGateway.defineGlobalFunction(_:argsSpec:body:)</code></a>; methods are defined
using <a href="../types/rbobject13.html?swift#definemethod_argsspecbody"><code>RbObject.defineMethod(_:argsSpec:body:)</code></a>; and singleton methods are
defined using <a href="../types/rbobject13.html?swift#definesingletonmethod_argsspecbody"><code>RbObject.defineSingletonMethod(_:argsSpec:body:)</code></a>.  These
all follow the same pattern.</p>
<p>The <a href="../types/rbmethodargsspec.html?swift"><code>RbMethodArgsSpec</code></a> is how you set the signature for the function: how many
arguments of what kinds, which ones have default values, which have keywords,
and so on.  For example, this defines a function to Ruby called <code>log</code> that
requires one argument and passes its string representation onwards;</p>
<pre><code class="language-swift">let logArgsSpec = RbMethodArgsSpec(leadingMandatoryCount: 1)
try Ruby.defineGlobalFunction(&quot;log&quot;,
                              argsSpec: logArgsSpec) { _, method in
    Logger.log(message: String(method.args.mandatory[0]))
    return .nilObject
}
</code></pre>
<p>Call from Ruby:</p>
<pre><code class="language-ruby">log(object_to_log)
</code></pre>
<p>A more complicated version taking keyword parameters including an optional
priority:</p>
<pre><code class="language-swift">let log2ArgsSpec = RbMethodArgsSpec(mandatoryKeywords: [&quot;message&quot;],
                                    optionalKeywordValues: [&quot;priority&quot; : 0 ])
try Ruby.defineGlobalFunction(&quot;log2&quot;,
                              argsSpec: log2ArgsSpec) { _, method in
    Logger.log(message: String(method.args.keyword[&quot;message&quot;]!),
               priority: Int(method.args.keyword[&quot;priority&quot;]!))
    return .nilObject
}
</code></pre>
<p>RubyGateway validates arguments and fills defaults before invoking the Swift
callback so guarantees all keywords have values.</p>
<p>Call from Ruby:</p>
<pre><code class="language-ruby">log2(message: object_to_log)
log2(message: object_to_log, priority: 2)
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="use-blocks-from-swift-methods">
<span data-anchor-id="use-blocks-from-swift-methods">
Use blocks from Swift methods
</span></h3>
<p>The <a href="../types/rbmethod.html?swift"><code>RbMethod</code></a> passed to your method callback provides access to the method’s
block.  The best way to invoke it is with an unguarded <code>try</code>, and let any
thrown errors propagate back to Swift.  This ensures that the control flow will
work properly should Ruby do <code>return</code> or <code>next</code> inside the block.</p>
<p>For example:</p>
<pre><code class="language-swift">let log3ArgsSpec = RbMethodArgsSpec(requiresBlock: true)
try Ruby.defineGlobalFunction(&quot;log3&quot;,
                              argsSpec: log3ArgsSpec) { _, method in
    let logContent = try method.yieldBlock()
    Logger.log(message: logContent)
    return .nilObject
}
</code></pre>
<p>If you need to handle exceptions from the <code>yield</code>, perhaps to do your own
cleanup or take some kind of special action, then pay attention to whether the
error is <a href="../types/rberror.html?swift#rubyjump_"><code>RbError.rubyJump(_:)</code></a> or <a href="../types/rberror.html?swift#rubyexception_"><code>RbError.rubyException(_:)</code></a>: for the former,
you can do your own cleanup but must rethrow the error and must not call into
Ruby as part of the cleanup.</p>
<h3 class="j2-anchor j2-heading heading" id="define-new-modules-in-swift">
<span data-anchor-id="define-new-modules-in-swift">
Define new modules in Swift
</span></h3>
<p>Use <a href="../types/rbgateway1.html?swift#definemodule_under"><code>RbGateway.defineModule(_:under:)</code></a> to define a new module.</p>
<p>For example:</p>
<pre><code class="language-swift">let outerModule = try Ruby.defineModule(&quot;MySystem&quot;)
let innerModule = try Ruby.defineModule(&quot;SubsystemA&quot;, under: outerModule)

try innerModule.defineSingletonMethod(&quot;activate&quot;) { ... }
</code></pre>
<p>…is equivalent to, in Ruby:</p>
<pre><code class="language-ruby">module MySystem
  module SubsystemA
    def self.activate
      ...
    end
  end
end
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="define-new-classes-in-swift">
<span data-anchor-id="define-new-classes-in-swift">
Define new classes in Swift
</span></h3>
<p>There are two different ways of doing this.  The first way is with
<a href="../types/rbgateway1.html?swift#defineclass_parentunder"><code>RbGateway.defineClass(_:parent:under:)</code></a> which works just like the module
example above, except it also supports <a href="../types/rbobject13.html?swift#definemethod_argsspecbody"><code>RbObject.defineMethod(_:argsSpec:body:)</code></a>
to define methods.</p>
<p>The other way is to bind a Swift class to the Ruby class.  A new instance
of the Swift class is associated with each instance of the Ruby class, and
Ruby methods are implemented by methods of the bound Swift class.</p>
<p>These classes are created with <a href="../types/rbgateway1.html?swift#defineclass_underinitializer"><code>RbGateway.defineClass(_:under:initializer:)</code></a>
and have methods defined with <a href="../types/rbobject13.html?swift#definemethod_argsspecmethod1"><code>RbObject.defineMethod(_:argsSpec:method:)</code></a>.</p>
<p>RubyGateway holds a strong reference to the object returned by the <code>initializer</code>
parameter throughout the life of the Ruby object, releasing it only when the
Ruby object is garbage-collected.</p>
<p>For example:</p>
<pre><code class="language-swift">// Must be a class, cannot be a struct.
class Invader {
    private var name = &quot;&quot;

    // Called during Ruby object allocation
    init() {
    }

    // Explicitly bound `initialize` called during Ruby `new`.
    func initialize(rbMethod: RbMethod) throws {
        name = try rbMethod.args.mandatory[0].convert()
    }

    // Bound methods can return any type conforming to `RbObjectConvertible`
    func name(rbMethod: RbMethod) throws -&gt; String {
        return name
    }

    // Bound methods can return `RbObject` to return various
    // Ruby types.  They also support blocks and any other variations
    // of Ruby argument passing.
    func listStats(rbMethod: RbMethod) throws -&gt; RbObject {
        if rbMethod.isBlockGiven {
            try rbMethod.yieldBlock(args: [&quot;Health&quot;, 100])
            try rbMethod.yieldBlock(args: [&quot;Shield&quot;, 25])
            return .nilObject
        } else {
            return [&quot;Health&quot;, 100, &quot;Shield&quot;, 25]
        }
    }

    // Bound methods can be 'Void' in Swift; RubyGateway inserts
    // the equivalent of 'return self' to Ruby.
    func fire(rbMethod: RbMethod) throws {
        ...
    }
}

let invaderClass = try Ruby.defineClass(&quot;Invader&quot;, initializer: Invader.init)
try invaderClass.defineMethod(&quot;initialize&quot;,
                              argsSpec: .basic(1),
                              method: Invader.initialize)
try invaderClass.defineMethod(&quot;name&quot;, method: Invader.name)
try invaderClass.defineMethod(&quot;list_stats&quot;, method: Invader.listStats)
try invaderClass.defineMethod(&quot;fire, method: Invader.fire)
</code></pre>
<p>Use from Ruby:</p>
<pre><code class="language-ruby">invader = Invader.new(&quot;Miles&quot;)
invader.list_stats do |name, score| in
  ...
end
invader.fire
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="run-finalizers-before-process-exit">
<span data-anchor-id="run-finalizers-before-process-exit">
Run finalizers before process exit
</span></h3>
<p>If you want to stop using Ruby and get on with something else, and
never come back to Ruby in the process, use <a href="../types/rbgateway1.html?swift#cleanup"><code>RbGateway.cleanup()</code></a>.</p>
<h3 class="j2-anchor j2-heading heading" id="work-with-ruby-complex-numbers">
<span data-anchor-id="work-with-ruby-complex-numbers">
Work with Ruby complex numbers
</span></h3>
<p>See <a href="../types/rbcomplex.html?swift"><code>RbComplex</code></a> for a thin wrapper to Ruby’s <code>Complex</code> type.</p>
<h3 class="j2-anchor j2-heading heading" id="work-with-ruby-rational-numbers">
<span data-anchor-id="work-with-ruby-rational-numbers">
Work with Ruby rational numbers
</span></h3>
<p>See <a href="../types/rbrational.html?swift"><code>RbRational</code></a> for a thin wrapper to Ruby’s <code>Rational</code> type.</p>
<h2 class="j2-anchor j2-heading heading" id="error-handling">
<span data-anchor-id="error-handling">
Error Handling
</span></h2>
<p>RubyGateway is very explicit about failure points.  Any Ruby method call can
raise an exception instead of terminating normally and this is reflected in the
throwable nature of most of the interesting RubyGateway methods.</p>
<p>Normally when writing Ruby scripts one doesn’t care about this and just lets
the program crash, which happens very rarely after the debugging phase.  If you
are using RubyGateway though, there is presumably a lot more happening for you
and your users than the Ruby stuff – otherwise you’d be writing Ruby, not
Swift.  I feel it does not make sense for a subsystem like this to decide how to
handle errors, so RubyGateway propagates all errors ([except when it doesn’t]
(#caveats-and-gotchas)).</p>
<p>And <code>try!</code> is always available for quick don’t-care-about-errors environments.</p>
<h3 class="j2-anchor j2-heading heading" id="errors-exceptions">
<span data-anchor-id="errors-exceptions">
Errors + Exceptions
</span></h3>
<p>All errors thrown are <a href="../types/rberror.html?swift"><code>RbError</code></a> which is an enum of various interface errors
detected by RubyGateway and one case <a href="../types/rberror.html?swift#rubyexception_"><code>RbError.rubyException(_:)</code></a> that covers all
Ruby exceptions.</p>
<p>RubyGateway remembers the last few <a href="../types/rberror.html?swift"><code>RbError</code></a>s that were generated and stores
them in the publicly available <a href="../types/rberror.html?swift#history1"><code>RbError.history</code></a>.</p>
<h3 class="j2-anchor j2-heading heading" id="nil-failures">
<span data-anchor-id="nil-failures">
<code>nil</code> failures
</span></h3>
<p>Converting Ruby values to Swift types works differently: it happens using
failable initializers such as <a href="../extensions/string.html?swift#init_5"><code>String.init(_:)</code></a>.  These can fail for a variety
of reasons.  When they do, RubyGateway still internally generates an <a href="../types/rberror.html?swift"><code>RbError</code></a>
and stores a copy in <a href="../types/rberror.html?swift#history1"><code>RbError.history</code></a> even though it is not thrown.  This
means you can diagnose why a conversion failed:</p>
<pre><code class="language-swift">guard let score = Float(scoreObj) else {
    print(&quot;Failed to get score back from Ruby: \(RbError.history.mostRecent)&quot;)
    return
}
</code></pre>
<h3 class="j2-anchor j2-heading heading" id="failable-adapter">
<span data-anchor-id="failable-adapter">
Failable Adapter
</span></h3>
<p><a href="../types/rbfailableaccess.html?swift"><code>RbFailableAccess</code></a> is a non-throwing adapter for <a href="../types/rbobject13.html?swift"><code>RbObject</code></a> and <a href="../types/rbgateway1.html?swift"><code>RbGateway</code></a> that
returns <code>nil</code> when there is an error.  All it does is <code>try?</code> the
corresponding throwing method, meaning that the details of the failure are
available in <a href="../types/rberror.html?swift#history1"><code>RbError.history</code></a>.</p>
<p>This is a steal of rough approach (the name is my fault) from the Python DML
sandbox with an eye to adding direct member lookup/callable to RubyGateway –
Swift subscripts can’t throw.</p>
<p>I’m not sure this is better than just writing <code>try?</code> which at least makes it
very difficult for readers to ignore the possibility of errors.</p>
<h2 class="j2-anchor j2-heading heading" id="concurrency">
<span data-anchor-id="concurrency">
Concurrency
</span></h2>
<p>RubyGateway inherits Ruby’s threading model.  This means you can only use
RubyGateway APIs on the first thread from which you use a RubyGateway API, and
then any other threads created by Ruby.</p>
<p>Outside of the very first time, it’s not possible to call Ruby on a random
thread created either directly by your program or by the Swift concurrency /
Dispatch runtime.</p>
<p>A reasonable pattern is to call some Ruby method during system startup on
the Swift <code>@MainActor</code> and then treat Ruby calls as requiring isolation to
that actor.  If you take calls <em>from</em> Ruby on Ruby-created threads, and
servicing these requires access to your Swift concurrency executors, then you
have to start a <code>Task</code> to do this, blocking &amp; then resuming the (Ruby) thread
while that work happens.  You have to be really careful with the GVL here to
avoid deadlocks or worse.</p>
<p><a href="../types/rbthread.html?swift"><code>RbThread</code></a> provides some static helpers for creating Ruby threads and
relinquishing the GVL: consult the internet for further guidance.</p>
<h2 class="j2-anchor j2-heading heading" id="caveats-and-gotchas">
<span data-anchor-id="caveats-and-gotchas">
Caveats and Gotchas
</span></h2>
<h3 class="j2-anchor j2-heading heading" id="crashiness">
<span data-anchor-id="crashiness">
Crashiness
</span></h3>
<p>Certain <a href="../types/rbobject13.html?swift"><code>RbObject</code></a> methods forward to Ruby calls and crash (<code>fatalError()</code>)
if Ruby fails / the object doesn’t support the method.  It’s up to you to be
sure the Ruby objects you’re dealing with are of the right type.  See
<a href="../types/rbobject13.html?swift"><code>RbObject</code></a> for more information on which these methods are.</p>
<h3 class="j2-anchor j2-heading heading" id="swift-closure-retention">
<span data-anchor-id="swift-closure-retention">
Swift closure retention
</span></h3>
<p>If you pass a Swift closure to a method as a block/proc/lambda that is used
by Ruby after that method finishes – ie. <em>not</em> the normal <code>#each</code>-type use –
then you need to understand <a href="../types/rbblockretention.html?swift"><code>RbBlockRetention</code></a>.</p>
<p>The reason for all this is that calling Swift code from Ruby requires an
intermediate Swift object, and RubyGateway needs to tie the lifetime of that
Swift object to something else in the Swift world.</p>
<h3 class="j2-anchor j2-heading heading" id="block-arity">
<span data-anchor-id="block-arity">
Block arity
</span></h3>
<p>The Ruby runtime cannot tell the arity (number of expected arguments) of
blocks created by the Ruby C API / RubyGateway – <code>Proc#arity</code> always comes
out as -1.  This means that any Ruby code that tries to be clever by inspecting
the arity of its block will not work as expected.</p>
<p>Ruby’s <code>Hash#each</code> suffers from this: instead of getting the key and value
passed separately you get one parameter, a two-element array of key and value.</p>
<h3 class="j2-anchor j2-heading heading" id="ruby-code-safety">
<span data-anchor-id="ruby-code-safety">
Ruby code safety
</span></h3>
<p>RubyGateway puts no restriction on what Ruby code can do: it can access the
filesystem, exit the process, and has complete access to the process’s memory.</p>
<p>Ruby has historically had a <code>$SAFE</code> feature that did some amount of sandboxing.
This was gradually deprecated over the years and removed entirely in Ruby 3.0.</p>
<p>Dealing with actively hostile Ruby code is best done with a separate process
or container; several examples on github.</p>
<h2 class="j2-anchor j2-heading heading" id="using-the-cruby-api">
<span data-anchor-id="using-the-cruby-api">
Using the CRuby API
</span></h2>
<p>The <a href="https://github.com/johnfairh/CRuby">CRuby</a> package provides access to as
much of the <code>libruby</code> API as makes it through the importer.  You can use this
in conjunction with RubyGateway to access more of the API than RubyGateway itself
provides.</p>
<p>Each <a href="../types/rbobject13.html?swift"><code>RbObject</code></a> wraps one <code>VALUE</code> keeping it safe from garbage collection.  You
can access that <code>VALUE</code> using <a href="../types/rbobject13.html?swift#withrubyvaluecall"><code>RbObject.withRubyValue(call:)</code></a>.</p>
<p>RubyGateway caches intern’ed Ruby strings - you can access the cache using
<a href="../types/rbgateway1.html?swift#getidfor"><code>RbGateway.getID(for:)</code></a>.</p>
<p>Note that when you call the Ruby API and Ruby raises an exception, the process
immediately crashes unless you are running inside <code>rb_protect()</code> or equivalent.</p>
<h2 class="j2-anchor j2-heading heading" id="swift-concurrency">
<span data-anchor-id="swift-concurrency">
Swift Concurrency
</span></h2>
<p>Sendable annotations and checking are thought to be complete.</p>
<p>That said it’s probably possible to defeat these checks with enough effort
because of the way Swift types are lost and reapplied either side of the C
layer.</p>
<h3 class="j2-anchor j2-heading heading" id="garbage-collection">
<span data-anchor-id="garbage-collection">
Garbage collection
</span></h3>
<p>The main risk using the <code>libruby</code> API is that GC happens too early on objects
you are trying to work with.</p>
<p>Ruby uses a mark and sweep GC.  This means the GC must be able to find the root
objects while they are live.  Two relevant techniques for this are:</p>
<ol>
<li>A list of known root objects;</li>
<li>Stack snooping.</li>
</ol>
<p><a href="../types/rbobject13.html?swift"><code>RbObject</code></a> holds one <code>VALUE</code> and stores it on the known list while the Swift
object is alive.  So if you solely use <a href="../types/rbobject13.html?swift"><code>RbObject</code></a>s then everything should be
fine. The only risk is that the Swift object dies before you expect it to;
the standard library includes <code>withExtendedLifetime(_:_:)</code> to help reason about
this.</p>
<p>Ruby GC scans the stack of each Ruby thread searching for <code>VALUE</code>s.  In very
old Ruby, the position of the stack was found from the address of a local
variable in an init function.  In modern Ruby, at least on Darwin &amp; Linux,
various pthread APIs are used instead which means there are no unwritten
rules about where the init function is called.</p>
<p>See <code>TestRbObject.testStackGc()</code> for a demo of this working in Swift.</p>
<p>This relies on the compiler actually placing <code>VALUE</code>s on the stack, which it is
not obliged to do.  In C the <code>RB_GC_GUARD()</code> macro forces its hand – a similar
thing should work in Swift but I haven’t managed to find a situation where the
Swift compiler does <em>not</em> put it on the stack so can’t test it.</p>
<h3 class="j2-anchor j2-heading heading" id="references">
<span data-anchor-id="references">
References
</span></h3>
<ul>
<li><a href="http://silverhammermba.github.io/emberb/">Ruby C API Guide</a> - great guide to
the API.</li>
<li><a href="http://ruby-hacking-guide.github.io">Ruby Hacking Guide</a> - in-depth on how
Ruby (an old version of) works.</li>
<li><a href="https://blog.heroku.com/incremental-gc">Incremental GC in Ruby</a> - very
interesting overview of GC pre + @ 2.2.</li>
</ul>
        </section>

        


        
        <div class="flex-grow-1"></div>
        <nav aria-label="paging" class="j2-pagination pb-3 pt-2">
  <div id="pagination-prev" class="flex-fill">
  
    <a class="j2-swift" href="../guides.html?swift" aria-keyshortcuts="p">
  <span aria-hidden="true">&laquo; </span>Guides
</a>

    <a class="j2-objc j2-secondary" href="../guides.html?swift" aria-keyshortcuts="p">
  <span aria-hidden="true">&laquo; </span>Guides
</a>

  
  
  </div>
  <div id="pagination-next" class="flex-fill text-end">
  
    <a class="j2-swift" href="../guides/todo.html?swift" aria-keyshortcuts="n">
  TODO<span aria-hidden="true"> &raquo;</span>
</a>

    <a class="j2-objc j2-secondary" href="../guides/todo.html?swift" aria-keyshortcuts="n">
  TODO<span aria-hidden="true"> &raquo;</span>
</a>

  
  
  </div>
</nav>

        

        </article>
      </main>

      <div class="col-xl d-none d-xl-block j2-aux-nav" id="aux-nav-column">
  <div class="j2-aux-nav-wrapper">
    
    <div class="j2-swift">
    <h6 class="j2-inline-heading">Topics</h6>
    <nav aria-label="page">
      <ul class="j2-aux-group">
        
        <li><a href="#using-rubygateway">Using RubyGateway</a></li>
        
        <li><a href="#general-usage">General Usage</a></li>
        
        <li><a href="#how-to-">How to …</a></li>
        
        <li><a href="#error-handling">Error Handling</a></li>
        
        <li><a href="#concurrency">Concurrency</a></li>
        
        <li><a href="#caveats-and-gotchas">Caveats and Gotchas</a></li>
        
        <li><a href="#using-the-cruby-api">Using the CRuby API</a></li>
        
        <li><a href="#swift-concurrency">Swift Concurrency</a></li>
        
      </ul>
    </nav>
    </div>
    
    
    <h6 class="j2-inline-heading">Actions</h6>
    <ul class="j2-aux-group">
      
      <li><a class="j2-aux-action" id="action-search" href="#" role="button" aria-keyshortcuts="/">Search (/)</a></li>
      
      
      
    </ul>
    
  </div>
</div>


    </div> <!-- end row -->

    <footer class="row">
  <div class="col j2-footer small pt-2">
    <p>Distributed under the MIT license.  Maintained by <a href="mailto:johnfairh@gmail.com">John Fairhurst</a>.</p>
    
    <p>Generated by <a class="link" href="https://github.com/johnfairh/Bebop" target="_blank" rel="external noopener">Bebop v1.11.0</a> using the FW2020 theme, based on technology from <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫</a>.</p>
    
  </div>
</footer>

  </div> <!-- container -->

  <script src="../js/dependencies.min.js"></script>
  
  <script src="../js/fw2020.js"></script>
  </body>
</html>
